webpackJsonp([15],{FWOp:function(t,e){},aNsk:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=s("CCn6"),n=s("JF9t"),i={props:{step_one_info:{type:Object,default:function(){}},step_two_info:{type:Object,default:function(){}}},components:{AreaTitle:function(){return s.e(19).then(s.bind(null,"it6S"))},Dialog:function(){return s.e(0).then(s.bind(null,"9q6c"))}},data:function(){return{loading:!0,tableData:[],socket:"",execute_flag:!1,execute_title:"开始执行",result_flag:!1,test_status:"未提取到数据",finish_count:0,executing_count:0,result_paas:0,result_not_paas:0,rc_loading:!1,result_type:"",pass_list:["通过","不通过"],show_result:!1,result_table:[],result_table_pageSize:10,result_table_currentPage:1,result_table_count:0}},methods:{con_websocket:function(t){var e=new WebSocket("ws://"+window.location.host+"/ws/query_status");console.log(e),this.socket=e,e.onmessage=function(t){var e=JSON.parse(t.data).message;console.log("message",e),a(e)},e.onclose=function(t){console.log("websocket closed！\n",t),n()},e.onopen=function(s){console.log("success"),e.send(t)};var s=function(){console.log("route",this.$route),"未完成"===this.test_status&&"/home/PaaS_wholeProcess"===this.$route.path&&(console.log("websocket重连"),this.con_websocket(t))}.bind(this),a=function(t){this.finish_count=t.finish_count,this.executing_count=t.executing_count,this.tableData=t.info,this.test_status=t.test_status,"未完成"===this.test_status?this.$message.info("测试中，请等候！"):"测试完成"===this.test_status&&(this.$message.success("测试完成！"),e.close(),this.result_flag=!0)}.bind(this),n=function(){s()}},start:function(){var t=this;this.execute_flag=!0,this.execute_title="执行中...",this.con_websocket(this.instance_id);var e={instance_id:this.instance_id,user_id:Object(n.a)("user_id")};a.a.whole_process_test.start_paas_task(e).then(function(e){500===e.status&&t.$message.error("系统异常，请联系管理员！")})},report_create:function(){var t=this;this.rc_loading=!0;var e={info:this.result_table,user_id:Object(n.a)("user_id")};a.a.config_manage_api.create_report(e).then(function(e){t.rc_loading=!1,t.$message.success("生成成功！！！"),window.open(e)})},look_result:function(){this.result_type="",this.handle_search()},filter_result:function(t){var e=this;this.result_type=t;var s={page:1,pageSize:10,require_name:this.require_name,result_type:t,product_name:Object(n.a)("product_name")};a.a.result_manage_api.query_result_detail(s).then(function(t){0===t.status&&(e.result_table=t.info,e.result_table_count=t.total_count)})},handleSizeChange:function(t){this.result_table_pageSize=t,this.handle_search()},handleCurrentChange:function(t){this.result_table_currentPage=t,this.handle_search()},handle_search:function(){var t=this;this.show_result=!0,this.result_paas=0,this.result_not_paas=0;var e={pageSize:this.result_table_pageSize,page:this.result_table_currentPage,require_name:this.require_name,result_type:this.result_type,product_name:Object(n.a)("product_name")};a.a.result_manage_api.query_result_detail(e).then(function(e){0===e.status?(t.result_paas=e.info.ret_info.test_pass,t.result_not_paas=e.info.ret_info.test_not_pass,t.result_table=e.info.ret_info.ret_info,t.result_table_count=e.info.total_count):console.log(e.info)})},close_dialog:function(){this.visibleEdit=!1},query_instance_info:function(){var t=this,e={instance_id:this.instance_id};a.a.whole_process_test.query_instance_info(e).then(function(e){0===e.status?(t.tableData=e.info.info,t.finish_count=e.info.finish_count,t.executing_count=e.info.executing_count,t.test_status=e.info.test_status):t.$message.error("系统异常，请联系管理员！"),t.loading=!1})},pass_is:function(t,e){var s=this,i={result_desc:e.diff_result,task_id:e.task_id,user_id:Object(n.a)("user_id")};a.a.paas_whole_test_api.paas_task_confirm(i).then(function(a){s.$set(s.tableData,t,e),s.$message.success("人工确认完成")})},close_socket:function(){var t=this;console.log("socket----",this.socket),"未完成"===this.test_status?this.$confirm("剩余任务未执行完毕, 是否离开该界面?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.rc_loading&&t.$message({type:"success",message:"稍后可到结果管理中查看执行结果!"}),""!==t.socket&&t.socket.close(),t.$emit("leave_route")}).catch(function(t){}):"测试完成"===this.test_status&&this.$emit("leave_route")},return_first_step:function(){""!==this.socket&&(this.socket=""),this.$emit("return_first_step")}},created:function(){this.loading=!0,this.query_instance_info()},computed:{instance_id:function(){return console.log("instance_id",this.step_two_info.instance_id),this.step_two_info.instance_id},task_info:{get:function(){return this.step_two_info.info},set:function(t){this.step_two_info.info=t}},require_name:function(){return this.step_one_info.instance_info.require_name}},watch:{finish_count:{handler:function(t,e){console.log("old_finish",e),console.log("new_finish",t)},immediate:!0}}},l={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"steq_panel_form",staticStyle:{"padding-bottom":"50px"}},[s("el-row",[s("el-col",{attrs:{span:4}},[s("AreaTitle",{attrs:{title:"测试任务编辑"}})],1),t._v(" "),s("el-col",{attrs:{span:10}},[!1===t.result_flag?s("el-button",{staticStyle:{margin:"auto"},attrs:{type:"primary",size:"mini",disabled:t.execute_flag,title:t.execute_title},on:{click:t.start}},[t._v(t._s(t.execute_title)+"\n      ")]):t._e(),t._v(" "),t.result_flag?s("el-button",{attrs:{type:"primary",size:"mini"},on:{click:t.look_result}},[t._v("查看结果")]):t._e(),t._v(" "),s("el-button",{attrs:{type:"primary",size:"mini",title:"点击返回第一步"},on:{click:t.return_first_step}},[t._v("返回首页")])],1)],1),t._v(" "),s("ul",{staticClass:"three_ul"},[s("li",[t._v("当前状态："+t._s(t.test_status))]),t._v(" "),s("li",[t._v("已完成数："+t._s(t.finish_count))]),t._v(" "),s("li",[t._v("未完成数："+t._s(t.executing_count))])]),t._v(" "),s("div",{staticClass:"table"},[s("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"selection",staticStyle:{width:"100%"},attrs:{data:t.tableData,"element-loading-text":"查询测试任务中，请稍后。。。","element-loading-spinner":"el-icon-loading","element-loading-background":"white",border:"","max-height":"400"}},[s("el-table-column",{attrs:{align:"center",prop:"task_id",label:"任务ID"}}),t._v(" "),s("el-table-column",{attrs:{align:"center",prop:"test_action",label:"用例ID"}}),t._v(" "),s("el-table-column",{attrs:{align:"center",prop:"test_name",label:"用例名称","show-overflow-tooltip":!0}}),t._v(" "),s("el-table-column",{attrs:{align:"center",prop:"expect_info",label:"预期和实际结果详情","show-overflow-tooltip":!0},scopedSlots:t._u([{key:"default",fn:function(e){return[s("el-tooltip",{staticClass:"item",attrs:{effect:"light",placement:"right-start"}},[s("div",{staticStyle:{width:"600px"},attrs:{slot:"content"},slot:"content"},[s("div",{staticClass:"div-a"},[s("h2",{staticStyle:{"text-align":"center",color:"blue"}},[t._v("预期结果")]),s("br"),t._v(" "),s("span",{staticClass:"ex_cell"},[t._v(t._s(e.row.expect_result))])]),t._v(" "),s("div",{staticClass:"div-b"},[s("h2",{staticStyle:{"text-align":"center",color:"blue"}},[t._v("实际结果")]),s("br"),t._v(" "),s("span",{staticClass:"ex_cell"},[t._v(t._s(e.row.really_result))])])]),t._v(" "),s("el-button",{directives:[{name:"show",rawName:"v-show",value:e.row.diff_result,expression:"scope.row.diff_result"}],attrs:{type:"text"}},[t._v("查看详情")])],1)]}}])}),t._v(" "),s("el-table-column",{attrs:{prop:"test_status",label:"测试状态","show-overflow-tooltip":!0,align:"center"}}),t._v(" "),s("el-table-column",{attrs:{prop:"diff_result",sortable:"",width:"125",label:"是否通过",align:"center","show-overflow-tooltip":!0}}),t._v(" "),s("el-table-column",{attrs:{label:"人工确认",align:"center","show-overflow-tooltip":!0},scopedSlots:t._u([{key:"default",fn:function(e){return t._l(t.pass_list,function(a){return"测试完成"===t.test_status?s("el-radio",{attrs:{label:a,value:a},on:{change:function(s){return t.pass_is(e.$index,e.row)}},model:{value:e.row.diff_result,callback:function(s){t.$set(e.row,"diff_result",s)},expression:"scope.row.diff_result"}}):t._e()})}}])})],1)],1),t._v(" "),s("Dialog",{attrs:{visible:t.show_result,width:"1000",title:"结果详情"},on:{closeDialog:function(e){t.show_result=!1}}},[s("div",{attrs:{slot:"con"},slot:"con"},[s("table",{staticClass:"info",staticStyle:{background:"#fff",height:"3rem",position:"relative",bottom:"2rem"},attrs:{id:"TableA"}},[s("tr",[s("th",[t._v("需求名称")]),t._v(" "),s("td",{staticStyle:{color:"blue"},attrs:{align:"center"}},[s("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"点击查看所有",placement:"top-start"}},[s("el-button",{attrs:{type:"text"},on:{click:function(e){return t.filter_result("")}}},[t._v(t._s(t.require_name))])],1)],1),t._v(" "),s("th",[t._v("通过个数")]),t._v(" "),s("td",{staticStyle:{color:"blue"},attrs:{align:"center"}},[s("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"点击查看通过用例",placement:"top-start"}},[s("el-button",{attrs:{type:"text"},on:{click:function(e){return t.filter_result("通过")}}},[t._v(t._s(t.result_paas))])],1)],1),t._v(" "),s("th",[t._v("未通过个数")]),t._v(" "),s("td",{attrs:{align:"center"}},[s("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"点击查看未通过用例",placement:"top-start"}},[s("el-button",{staticStyle:{color:"red"},attrs:{type:"text"},on:{click:function(e){return t.filter_result("不通过")}}},[t._v(t._s(t.result_not_paas)+"\n              ")])],1)],1),t._v(" "),s("th",[t._v("操作")]),t._v(" "),s("td",{staticStyle:{color:"blue"},attrs:{align:"center"}},[s("el-button",{attrs:{type:"primary",icon:"el-icon-document",size:"mini",loading:t.rc_loading},on:{click:t.report_create}},[t._v("生成报告\n            ")])],1)])]),t._v(" "),s("el-table",{staticStyle:{width:"100%",position:"relative",bottom:"2rem"},attrs:{data:t.result_table,border:"","header-cell-style":{background:"#5fb3f4",color:"white"},height:"34rem"}},[s("el-table-column",{attrs:{type:"expand"},scopedSlots:t._u([{key:"default",fn:function(e){return[s("el-form",{staticClass:"form_style",attrs:{"label-position":"left",inline:""}},[s("el-form-item",{attrs:{label:"测试任务ID："}},[s("span",[t._v(t._s(e.row.task_id))])]),t._v(" "),s("br"),t._v(" "),s("el-form-item",{attrs:{label:"测试用例名称："}},[s("span",[t._v(t._s(e.row.test_name))])]),t._v(" "),s("br"),t._v(" "),s("el-form-item",{attrs:{label:"预期结果："}},[s("span",[t._v(t._s(e.row.expect_result))])]),t._v(" "),s("br"),t._v(" "),s("el-form-item",{attrs:{label:"实际结果："}},[s("span",[t._v(t._s(e.row.real_result))])]),t._v(" "),s("br"),t._v(" "),s("el-form-item",{attrs:{label:"是否通过："}},[s("span",[t._v(t._s(e.row.result_desc))])])],1)]}}])}),t._v(" "),s("el-table-column",{attrs:{prop:"task_id",width:"100",label:"测试任务ID",align:"center","show-overflow-tooltip":!0}}),t._v(" "),s("el-table-column",{attrs:{prop:"test_name",width:"120",label:"测试用例名称",align:"center","show-overflow-tooltip":!0}}),t._v(" "),s("el-table-column",{attrs:{prop:"expect_result",width:"300",label:"预期结果","show-overflow-tooltip":!0}}),t._v(" "),s("el-table-column",{attrs:{prop:"real_result",width:"300",label:"实际结果","show-overflow-tooltip":!0}}),t._v(" "),s("el-table-column",{attrs:{prop:"result_desc",label:"是否通过",align:"center","show-overflow-tooltip":!0}})],1),t._v(" "),s("div",{staticClass:"search_pagination tr"},[s("el-pagination",{attrs:{"current-page":t.result_table_currentPage,"page-size":t.result_table_pageSize,"page-sizes":[5,10,15],layout:"sizes, prev, pager, next",total:t.result_table_count},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange,"update:currentPage":function(e){t.result_table_currentPage=e},"update:current-page":function(e){t.result_table_currentPage=e}}})],1)],1)])],1)},staticRenderFns:[]};var o=s("VU/8")(i,l,!1,function(t){s("FWOp")},"data-v-1ac85a9c",null);e.default=o.exports}});
//# sourceMappingURL=15.4c96afd69f48ce0c490b.js.map