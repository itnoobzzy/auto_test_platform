webpackJsonp([14],{YHRh:function(t,e){},nxqy:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=s("CCn6"),o=s("JF9t"),i={props:{step_one_info:{type:Object,default:function(){}},step_three_info:{type:Object,default:function(){}}},components:{AreaTitle:function(){return s.e(19).then(s.bind(null,"it6S"))}},data:function(){return{tableData:[],socket:"",execute_flag:!1,execute_title:"开始执行",result_flag:!1,test_status:"未提取到数据",finish_count:0,executing_count:0}},methods:{con_websocket:function(t){var e=new WebSocket("ws://"+window.location.host+"/ws/query_status");console.log(e),this.socket=e,e.onmessage=function(t){var e=JSON.parse(t.data).message;console.log("message",e),n(e)},e.onclose=function(t){console.log("websocket closed！"),o()},e.onopen=function(s){console.log("success"),e.send(t)};var s=function(){console.log("route",this.$route),"未完成"===this.test_status&&"/home/SaaS_wholeProcess"===this.$route.path&&(console.log("websocket重连"),this.con_websocket(t))}.bind(this),n=function(t){this.finish_count=t.finish_count,this.executing_count=t.executing_count,this.tableData=t.info,this.test_status=t.test_status,"未完成"===this.test_status?this.$message.info("测试中，请等候！"):"测试完成"===this.test_status&&(this.$message.success("测试完成！"),e.close(),this.result_flag=!0)}.bind(this),o=function(){s()}},start:function(){var t=this;this.execute_flag=!0,this.execute_title="执行中...",this.con_websocket(this.instance_id);var e={instance_id:this.instance_id,user_id:Object(o.a)("user_id"),user_token:Object(o.a)("user_token")};n.a.whole_test_api.whl_execute_test(e).then(function(e){0===e.status?t.result_flag=!0:-1===e.status&&t.$message.error("系统异常，请联系管理员！")})},look_result:function(){this.$router.push({path:"/result/all_net_test_result",query:{offer_id:this.offer_id}})},query_instance_info:function(){var t=this,e={instance_id:this.instance_id};n.a.whole_process_test.query_instance_info(e).then(function(e){0===e.status?(t.tableData=e.info.info,t.finish_count=e.info.finish_count,t.executing_count=e.info.executing_count,t.test_status=e.info.test_status):t.$message.error("系统异常，请联系管理员！")})},close_socket:function(){var t=this;console.log("socket----",this.socket),"未完成"===this.test_status?this.$confirm("剩余任务未执行完毕, 是否离开该界面?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.execute_flag&&t.$message({type:"success",message:"稍后可到结果管理中查看执行结果!"}),""!==t.socket&&t.socket.close(),t.$emit("leave_route",!0)}).catch(function(t){}):"测试完成"===this.test_status&&this.$emit("leave_route",!0)}},mounted:function(){this.query_instance_info()},computed:{offer_id:function(){return this.step_one_info.form.fee_code.toString()},instance_id:function(){return console.log("instance_id",this.step_three_info.instance_id),this.step_three_info.instance_id}},watch:{finish_count:{handler:function(t,e){console.log("old_finish",e),console.log("new_finish",t)},immediate:!0}}},a={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"steq_panel_form",staticStyle:{"padding-bottom":"50px"}},[s("el-row",[s("el-col",{attrs:{span:4}},[s("AreaTitle",{attrs:{title:"测试任务编辑"}})],1),t._v(" "),s("el-col",{attrs:{span:10}},[!1===t.result_flag?s("el-button",{staticStyle:{margin:"auto"},attrs:{type:"primary",size:"mini",disabled:t.execute_flag,title:t.execute_title},on:{click:t.start}},[t._v(t._s(t.execute_title)+"\n      ")]):t._e(),t._v(" "),t.result_flag?s("el-button",{attrs:{type:"primary",size:"mini"},on:{click:t.look_result}},[t._v("查看结果")]):t._e()],1)],1),t._v(" "),s("ul",{staticClass:"three_ul"},[s("li",[t._v("当前状态："+t._s(t.test_status))]),t._v(" "),s("li",[t._v("已完成数："+t._s(t.finish_count))]),t._v(" "),s("li",[t._v("未完成数："+t._s(t.executing_count))])]),t._v(" "),s("div",{staticClass:"table"},[s("el-table",{ref:"selection",staticStyle:{width:"100%"},attrs:{data:t.tableData,border:"","max-height":"400"}},[s("el-table-column",{attrs:{align:"center",prop:"id",label:"任务ID"}}),t._v(" "),s("el-table-column",{attrs:{align:"center",prop:"test_name",label:"测试用例","show-overflow-tooltip":!0}}),t._v(" "),s("el-table-column",{attrs:{align:"center",prop:"test_status",label:"测试状态"}}),t._v(" "),s("el-table-column",{attrs:{align:"center",prop:"expect_info",label:"预期结果"}}),t._v(" "),s("el-table-column",{attrs:{align:"center",prop:"result_info",label:"实际结果"}}),t._v(" "),s("el-table-column",{attrs:{align:"center",prop:"result_desc",label:"是否通过"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.result_desc>2?s("span",{staticStyle:{color:"red"}},[t._v(t._s(e.row.result_desc))]):s("span",{staticStyle:{color:"black"}},[t._v(t._s(e.row.result_desc))])]}}])})],1)],1)],1)},staticRenderFns:[]};var c=s("VU/8")(i,a,!1,function(t){s("YHRh")},"data-v-5f7c9a6b",null);e.default=c.exports}});
//# sourceMappingURL=14.1672b5d23f437b5b4425.js.map