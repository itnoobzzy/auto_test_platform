webpackJsonp([4],{"4zZL":function(e,t){},J32i:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a("JF9t"),n=a("CCn6"),s=a("zL8q"),r={components:{CardBox:function(){return new Promise(function(e){e()}).then(a.bind(null,"B2nC"))},Dialog:function(){return a.e(0).then(a.bind(null,"9q6c"))}},data:function(){var e=this;return{title:"",add_case_visible:!1,test_env_list:[],case_form:{case_id:"",case_name:"",input_data:"",preset_data:""},placeholder:"",tooltip_content:"提示",tooltip_content2:"",rules:{case_name:[{required:!0,message:"请输入用例名称",trigger:"blur"},{validator:function(t,a,s){var r={user_id:Object(i.a)("user_id"),case_name:e.case_form.case_name,test_type:"单元测试"};n.a.config_manage_api.check_special_case_name(r).then(function(t){0===t.status&&(t.info&&"新增"===e.title?s(new Error("该用例名称已存在，请更换！")):s())})},trigger:"change"}],input_data:[{required:!0,message:"请输入测试命令",trigger:"blur"}]},loading:!1,search_input:{left_search:"",right_search:""},right_search_flag:!1,unbind_case_table_data:[],unbind_case_total_count:0,left_page_size:10,left_current_page:1,left_total_count:0,bind_case_table_data:[],search_bind_case_table_data:[],right_page_size:10,right_current_page:1,right_total_count:0,left_select_case:[],right_select_case:[]}},methods:{handle_code_update:function(e){var t=this;console.log(e),this.loading=!0;var a={user_id:Object(i.a)("user_id"),image_name:e.preset_data,program_dir:e.program_dir,local_program_dir:e.local_program_dir,vcs_type:e.vcs_type,svn_dir:e.svn_dir,git_dir:e.git_dir,git_branch_name:e.git_branch_name};n.a.config_manage_api.get_docker_data(a).then(function(e){0===e.status?t.$message.success("容器内代码更新成功！"):t.$message.error("系统异常，请联系管理员！"),t.loading=!1})},handle_search:function(){var e=this,t={case_name:this.search_input.left_search,page:this.left_current_page,pageSize:this.left_page_size,user_id:Object(i.a)("user_id"),test_type:"单元测试"};n.a.config_manage_api.check_special_case_info(t).then(function(t){0===t.status?(e.unbind_case_total_count=t.total_count,e.unbind_case_table_data=t.info):e.$message.error("系统异常，请联系管理员！")})},right_handle_size_change:function(e){this.right_page_size=e},right_handle_current_change:function(e){this.right_current_page=e},left_handle_size_change:function(e){this.left_page_size=e,this.handle_search()},left_handle_current_change:function(e){this.left_current_page=e,this.handle_search()},reset_left_search:function(){this.search_input.left_search="",this.left_handle_current_change(1)},right_search:function(){var e=this;this.search_bind_case_table_data=[],this.bind_case_table_data.forEach(function(t){t.case_name.indexOf(e.search_input.right_search)>-1&&e.search_bind_case_table_data.push(t)}),this.right_current_page=1,this.right_search_flag=!0},right_reset_search:function(){this.right_search_flag=!1,this.search_bind_case_table_data=[],this.search_input.right_search="",this.right_current_page=1},left_selected:function(e){this.left_select_case=e},handle_bind:function(){var e=[];this.bind_case_table_data.forEach(function(t){e.push(t.case_id)});var t=this.left_select_case.filter(function(t){return e.indexOf(t.case_id)<0});this.bind_case_table_data=this.bind_case_table_data.concat(t).sort(function(e,t){return t.case_id-e.case_id});var a=[];this.search_bind_case_table_data.forEach(function(e){a.push(e.case_id)});var i=this.left_select_case.filter(function(e){return a.indexOf(e.case_id)<0});this.right_search_flag&&(this.search_bind_case_table_data=this.search_bind_case_table_data.concat(i).sort(function(e,t){return t.case_id-e.case_id})),this.right_handle_current_change(1)},create_test_task:function(e){var t=this,a=[];this.bind_case_table_data.forEach(function(e){a.push(e.case_id)}),console.log("case_id_list",a);var r=s.Loading.service({fullscreen:!0}),_={product_name:Object(i.a)("product_name"),user_name:Object(i.a)("user_name"),id_list:a,require_name:e};n.a.whole_process_test.create_whole_process_task(_).then(function(e){if(0===e.status){var a={};a.instance_id=e.info.instance_id,a.info=e.info,t.$emit("next_step","step_two",a)}else t.$message.error("生成测试任务失败，请联系系统管理员！");r.close()})},right_selected:function(e){this.right_select_case=e},handle_unbind:function(){this.remove_right_selected(this.right_select_case),this.right_handle_current_change(1)},remove_right_selected:function(e){Array.prototype.diff=function(e){return this.filter(function(t){return e.indexOf(t)<0})},this.bind_case_table_data=this.bind_case_table_data.diff(e),this.right_search_flag&&(this.search_bind_case_table_data=this.bind_case_table_data.diff(e))},add_test_case:function(){this.title="新增",this.case_form={case_id:"",case_name:"",preset_data:"",input_data:""},this.add_case_visible=!0},handle_edit:function(e){this.title="编辑",this.case_form={case_id:e.case_id,case_name:e.case_name,preset_data:e.preset_data,input_data:e.input_data},console.log(e),console.log(this.case_form),this.add_case_visible=!0},close_add:function(){this.$refs.case_form.resetFields(),this.add_case_visible=!1},handle_submit:function(e){var t=this;this.$refs[e].validate(function(e){if(!e)return console.log("error submit!!"),!1;var a={case_id:t.case_form.case_id,case_name:t.case_form.case_name,input_data:t.case_form.input_data,user_id:Object(i.a)("user_id"),test_type:"单元测试",preset_data:t.case_form.preset_data};switch(t.title){case"新增":n.a.config_manage_api.add_special_case_info(a).then(function(e){0===e.status?(t.$message.success("增加成功！"),t.left_handle_current_change(1)):t.$message.error("系统异常，请联系管理员！")});break;case"编辑":n.a.config_manage_api.update_special_case_info(a).then(function(e){0===e.status?(t.$message.success("编辑成功！"),t.left_handle_current_change(1)):t.$message.error("系统异常，请联系管理员！")})}t.add_case_visible=!1})},get_test_env_list:function(){var e=this,t={user_id:Object(i.a)("user_id")};n.a.config_manage_api.query_docker_data(t).then(function(t){0===t.status?e.test_env_list=t.info:e.$message.error("查询容器环境列表失败！")})}},mounted:function(){this.left_handle_current_change(1),this.get_test_env_list()}},_={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[[a("div",{staticClass:"steq_panel_form"},[a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",[a("CardBox",{attrs:{title:"选择测试用例"}},[a("template",{slot:"body"},[a("div",{staticClass:"search_box"},[a("el-input",{staticStyle:{width:"219px"},attrs:{placeholder:"请输入用例名称","suffix-icon":"el-icon-search",size:"small"},model:{value:e.search_input.left_search,callback:function(t){e.$set(e.search_input,"left_search",t)},expression:"search_input.left_search"}}),e._v(" "),a("div",[a("el-button",{staticStyle:{background:"none",float:"left"},attrs:{type:"primary",plain:"",size:"mini"},on:{click:e.add_test_case}},[e._v("新增\n                  ")]),e._v(" "),a("el-button",{staticStyle:{background:"none"},attrs:{type:"primary",plain:"",size:"mini"},on:{click:e.reset_left_search}},[e._v("重置\n                  ")]),e._v(" "),a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){return e.left_handle_current_change(1)}}},[e._v("查询")])],1)],1),e._v(" "),a("div",{staticClass:"search_table"},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:e.unbind_case_table_data,border:"",size:"small","element-loading-text":"更新中","element-loading-spinner":"el-icon-loading","element-loading-background":"white"},on:{"selection-change":e.left_selected}},[a("el-table-column",{attrs:{type:"selection",width:"30"}}),e._v(" "),a("el-table-column",{attrs:{prop:"case_id",label:"测试用例ID"}}),e._v(" "),a("el-table-column",{attrs:{prop:"case_name",label:"测试用例名称","show-overflow-tooltip":!0}}),e._v(" "),a("el-table-column",{attrs:{prop:"preset_data",label:"测试容器名称","show-overflow-tooltip":!0}}),e._v(" "),a("el-table-column",{attrs:{prop:"input_data",label:"执行命令","show-overflow-tooltip":!0}}),e._v(" "),a("el-table-column",{attrs:{label:"操作",width:"190"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text",size:"mini",icon:"el-icon-edit"},on:{click:function(a){return e.handle_edit(t.row)}}},[e._v("\n                        编辑\n                      ")]),e._v(" "),a("el-button",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"my_button",attrs:{type:"text",size:"mini",icon:"el-icon-refresh","element-loading-text":"更新中","element-loading-spinner":"el-icon-loading","element-loading-background":"white"},on:{click:function(a){return e.handle_code_update(t.row)}}},[e._v("更新代码\n                      ")])]}}])})],1)],1),e._v(" "),a("div",{staticClass:"search_pagination"},[a("el-pagination",{attrs:{"current-page":e.left_current_page,"page-sizes":[5,10,15],"page-size":e.left_page_size,layout:"sizes, prev, pager, next",total:e.unbind_case_total_count},on:{"size-change":e.left_handle_size_change,"current-change":e.left_handle_current_change,"update:currentPage":function(t){e.left_current_page=t},"update:current-page":function(t){e.left_current_page=t}}})],1)])],2)],1),e._v(" "),a("el-col",{attrs:{span:2}},[a("div",{staticClass:"search_option"},[a("el-button",{attrs:{type:"primary",icon:"el-icon-arrow-right"},on:{click:e.handle_bind}}),e._v(" "),a("el-button",{attrs:{icon:"el-icon-arrow-left"},on:{click:e.handle_unbind}})],1)]),e._v(" "),a("el-col",[a("CardBox",{attrs:{title:"确认绑定"}},[a("template",{slot:"body"},[a("div",{staticClass:"search_box"},[a("el-input",{staticStyle:{width:"219px"},attrs:{placeholder:"请输入用例名称","suffix-icon":"el-icon-search",size:"small"},model:{value:e.search_input.right_search,callback:function(t){e.$set(e.search_input,"right_search",t)},expression:"search_input.right_search"}}),e._v(" "),a("div",[a("el-button",{staticStyle:{background:"none"},attrs:{type:"primary",plain:"",size:"mini"},on:{click:e.right_reset_search}},[e._v("\n                    重置\n                  ")]),e._v(" "),a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.right_search}},[e._v("查询")])],1)],1),e._v(" "),a("div",{staticClass:"search_table"},[e.right_search_flag?a("div",[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:e.search_bind_case_table_data.slice((e.right_current_page-1)*e.right_page_size,e.right_current_page*e.right_page_size),border:"",size:"small","element-loading-text":"更新中","element-loading-spinner":"el-icon-loading","element-loading-background":"white"},on:{"selection-change":e.right_selected}},[a("el-table-column",{attrs:{type:"selection",width:"30"}}),e._v(" "),a("el-table-column",{attrs:{prop:"case_id",label:"用例ID"}}),e._v(" "),a("el-table-column",{attrs:{prop:"case_name",label:"用例名称","show-overflow-tooltip":!0}}),e._v(" "),a("el-table-column",{attrs:{prop:"preset_data",label:"容器名称","show-overflow-tooltip":!0}}),e._v(" "),a("el-table-column",{attrs:{prop:"input_data",label:"执行命令","show-overflow-tooltip":!0}}),e._v(" "),a("el-table-column",{attrs:{label:"操作",width:"190"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text",size:"mini",icon:"el-icon-edit"},on:{click:function(a){return e.handle_edit(t.row)}}},[e._v("\n                          编辑\n                        ")]),e._v(" "),a("el-button",{staticClass:"my_button",attrs:{type:"text",size:"mini",icon:"el-icon-refresh"},on:{click:function(a){return e.handle_code_update(t.row)}}},[e._v("更新代码\n                        ")])]}}],null,!1,1391170496)})],1),e._v(" "),a("div",{staticClass:"search_pagination"},[a("el-pagination",{attrs:{"current-page":e.right_current_page,"page-sizes":[5,10,15],"page-size":e.right_page_size,layout:"sizes, prev, pager, next",total:e.search_bind_case_table_data.length},on:{"size-change":e.right_handle_size_change,"current-change":e.right_handle_current_change,"update:currentPage":function(t){e.right_current_page=t},"update:current-page":function(t){e.right_current_page=t}}})],1)],1):a("div",[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.bind_case_table_data.slice((e.right_current_page-1)*e.right_page_size,e.right_current_page*e.right_page_size),border:"",size:"small"},on:{"selection-change":e.right_selected}},[a("el-table-column",{attrs:{type:"selection",width:"30"}}),e._v(" "),a("el-table-column",{attrs:{prop:"case_id",label:"用例ID"}}),e._v(" "),a("el-table-column",{attrs:{prop:"case_name",label:"用例名称","show-overflow-tooltip":!0}}),e._v(" "),a("el-table-column",{attrs:{prop:"preset_data",label:"容器名称","show-overflow-tooltip":!0}}),e._v(" "),a("el-table-column",{attrs:{prop:"input_data",label:"执行命令","show-overflow-tooltip":!0}})],1),e._v(" "),a("div",{staticClass:"search_pagination"},[a("el-pagination",{attrs:{"current-page":e.right_current_page,"page-sizes":[5,10,15],"page-size":e.right_page_size,layout:"sizes, prev, pager, next",total:e.bind_case_table_data.length},on:{"size-change":e.right_handle_size_change,"current-change":e.right_handle_current_change,"update:currentPage":function(t){e.right_current_page=t},"update:current-page":function(t){e.right_current_page=t}}})],1)],1)])])],2)],1)],1)],1)],e._v(" "),a("Dialog",{attrs:{visible:e.add_case_visible,width:"600",title:"新增测试用例"},on:{closeDialog:e.close_add}},[a("div",{attrs:{slot:"con"},slot:"con"},[a("el-form",{ref:"case_form",attrs:{model:e.case_form,"label-width":"140px",rules:e.rules,size:"mini"}},[a("el-form-item",{attrs:{label:"用例名称",prop:"case_name"}},[a("el-input",{staticStyle:{width:"50%"},attrs:{plceholder:"请输入用例名称"},model:{value:e.case_form.case_name,callback:function(t){e.$set(e.case_form,"case_name",t)},expression:"case_form.case_name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"执行命令",prop:"input_data"}},[a("el-input",{staticStyle:{width:"50%"},attrs:{placeholder:e.placeholder},model:{value:e.case_form.input_data,callback:function(t){e.$set(e.case_form,"input_data",t)},expression:"case_form.input_data"}}),e._v(" "),a("el-tooltip",{staticClass:"item",attrs:{effect:"light",placement:"right-start"}},[a("div",{attrs:{slot:"content"},slot:"content"},[e._v(e._s(e.tooltip_content)),a("br"),e._v(e._s(e.tooltip_content2))]),e._v(" "),a("el-button",{attrs:{icon:"el-icon-info",size:"mini",type:"text"}})],1)],1),e._v(" "),a("el-form-item",{attrs:{label:"执行容器环境",prop:"env_info"}},[a("el-select",{attrs:{placeholder:"请选择用例执行容器环境"},model:{value:e.case_form.preset_data,callback:function(t){e.$set(e.case_form,"preset_data",t)},expression:"case_form.preset_data"}},e._l(e.test_env_list,function(t){return a("el-option",{key:t.id,attrs:{label:t.image_name,value:t.image_name}},[a("span",[e._v("容器名称：")]),e._v(" "),a("span",[e._v(e._s(t.image_name))])])}),1)],1)],1)],1),e._v(" "),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("div",{staticClass:"dialog__footer"},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.handle_submit("case_form")}}},[e._v("确认")])],1)])])],2)},staticRenderFns:[]};var c=a("VU/8")(r,_,!1,function(e){a("oqHr"),a("4zZL")},"data-v-598d4109",null);t.default=c.exports},oqHr:function(e,t){}});
//# sourceMappingURL=4.e7f9463cef4792ddf62d.js.map