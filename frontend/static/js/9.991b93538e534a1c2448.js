webpackJsonp([9],{"19WZ":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a("JF9t"),n=a("CCn6"),_={components:{CardBox:function(){return new Promise(function(e){e()}).then(a.bind(null,"B2nC"))}},data:function(){return{loading_query_rate:!1,timer:"",search_input:{left_search:"",right_search:""},right_search_flag:!1,unbind_template_table_data:[],unbind_template_total_count:0,left_page_size:10,left_current_page:1,left_total_count:0,bind_template_table_data:[],search_bind_template_table_data:[],right_page_size:10,right_current_page:1,right_total_count:0,left_select_template:[],right_select_case:[],bind_template_info:[],next_step_flag:!1}},methods:{handle_search:function(){var e=this,t={module_name:this.search_input.left_search,page:this.left_current_page,pageSize:this.left_page_size,user_id:Object(i.a)("user_id")};n.a.config_manage_api.check_case_template(t).then(function(t){0===t.status?(e.unbind_template_total_count=t.total_count,e.unbind_template_table_data=t.info):e.$message.error("系统异常，请联系管理员！")})},right_handle_size_change:function(e){this.right_page_size=e},right_handle_current_change:function(e){this.right_current_page=e},left_handle_size_change:function(e){this.left_page_size=e,this.handle_search()},left_handle_current_change:function(e){this.left_current_page=e,this.handle_search()},reset_left_search:function(){this.search_input.left_search="",this.left_handle_current_change(1)},right_search:function(){var e=this;this.search_bind_template_table_data=[],this.bind_template_table_data.forEach(function(t){t.module_name.indexOf(e.search_input.right_search)>-1&&e.search_bind_template_table_data.push(t)}),this.right_current_page=1,this.right_search_flag=!0},right_reset_search:function(){this.right_search_flag=!1,this.search_bind_template_table_data=[],this.search_input.right_search="",this.right_current_page=1},left_selected:function(e){this.left_select_template=e},handle_bind:function(){var e=[];this.bind_template_table_data.forEach(function(t){e.push(t.case_template_id)});var t=this.left_select_template.filter(function(t){return e.indexOf(t.case_template_id)<0});this.bind_template_table_data=this.bind_template_table_data.concat(t).sort(function(e,t){return t.case_template_id-e.case_template_id});var a=[];this.search_bind_template_table_data.forEach(function(e){a.push(e.case_template_id)});var i=this.left_select_template.filter(function(e){return a.indexOf(e.case_template_id)<0});this.right_search_flag&&(this.search_bind_template_table_data=this.search_bind_template_table_data.concat(i).sort(function(e,t){return t.template_id-e.template_id})),this.right_handle_current_change(1);var n=[];this.bind_template_table_data.forEach(function(e){n.push(e.case_template_id)}),this.get_case_id_list(n)},get_case_id_list:function(e){for(var t=this,a=function(a,_){if(void 0===t.bind_template_info.find(function(t){return t.template_id===e[a]})){var r=[],l={case_template_id:e[a],page:1,pageSize:3,user_id:Object(i.a)("user_id")};n.a.config_manage_api.get_template_bind_case(l).then(function(i){0===i.status&&(i.info.bind_info.forEach(function(e){r.push(e.case_id)}),t.bind_template_info.push({template_id:e[a],case_id_list:r})),console.log(t.bind_template_info.length-1,a),t.bind_template_info.length-1===a&&(t.next_step_flag=!0)})}},_=0,r=e.length;_<r;_++)a(_)},get_case_rate:function(e){var t=this;if(this.loading_query_rate=!0,this.timer=setInterval(function(){console.log(t.next_step_flag),t.next_step_flag&&clearInterval(t.timer)},1e3),!0===this.next_step_flag){var a={offer_id:e,bind_template_info:this.bind_template_info,user_id:Object(i.a)("user_id")};n.a.config_manage_api.query_case_rate(a).then(function(e){if(0===e.status){var a={};a.rate_info=e.info,t.$emit("next_step","step_two",a)}else t.$message.error("系统异常，请联系管理员！");t.loading_query_rate=!1})}},right_selected:function(e){this.right_select_case=e},handle_unbind:function(){this.remove_right_selected(this.right_select_case),this.right_handle_current_change(1)},remove_right_selected:function(e){var t=this;Array.prototype.diff=function(e){return this.filter(function(t){return e.indexOf(t)<0})},this.bind_template_table_data=this.bind_template_table_data.diff(e),this.right_search_flag&&(this.search_bind_template_table_data=this.bind_template_table_data.diff(e)),e.forEach(function(e){var a=t.bind_template_info.findIndex(function(t){return t.template_id===e.case_template_id});t.bind_template_info.splice(a,1)})}},mounted:function(){this.left_handle_current_change(1)},beforeDestroy:function(){clearInterval(this.timer)}},r={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[[a("div",{staticClass:"steq_panel_form"},[a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",[a("CardBox",{attrs:{title:"选择测试模板"}},[a("template",{slot:"body"},[a("div",{staticClass:"search_box"},[a("el-input",{staticStyle:{width:"219px"},attrs:{placeholder:"请输入模板名称","suffix-icon":"el-icon-search",size:"small"},model:{value:e.search_input.left_search,callback:function(t){e.$set(e.search_input,"left_search",t)},expression:"search_input.left_search"}}),e._v(" "),a("div",[a("el-button",{staticStyle:{background:"none"},attrs:{type:"primary",plain:"",size:"small"},on:{click:e.reset_left_search}},[e._v("重置")]),e._v(" "),a("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){return e.left_handle_current_change(1)}}},[e._v("查询")])],1)],1),e._v(" "),a("div",{staticClass:"search_table"},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading_query_rate,expression:"loading_query_rate"},{name:"loading",rawName:"v-loading.fullscreen.lock",value:e.loading_query_rate,expression:"loading_query_rate",modifiers:{fullscreen:!0,lock:!0}}],staticStyle:{width:"100%"},attrs:{data:e.unbind_template_table_data,border:"",size:"small","element-loading-text":"跳转中，请稍等。。。","element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(0, 0, 0, 0.8)"},on:{"selection-change":e.left_selected}},[a("el-table-column",{attrs:{type:"selection",width:"30"}}),e._v(" "),a("el-table-column",{attrs:{prop:"case_template_id",label:"测试模板ID",width:"100"}}),e._v(" "),a("el-table-column",{attrs:{prop:"module_name",label:"测试模板名称","show-overflow-tooltip":!0}})],1)],1),e._v(" "),a("div",{staticClass:"search_pagination"},[a("el-pagination",{attrs:{"current-page":e.left_current_page,"page-sizes":[5,10,15],"page-size":e.left_page_size,layout:"sizes, prev, pager, next",total:e.unbind_template_total_count},on:{"size-change":e.left_handle_size_change,"current-change":e.left_handle_current_change,"update:currentPage":function(t){e.left_current_page=t},"update:current-page":function(t){e.left_current_page=t}}})],1)])],2)],1),e._v(" "),a("el-col",{attrs:{span:2}},[a("div",{staticClass:"search_option"},[a("el-button",{attrs:{type:"primary",icon:"el-icon-arrow-right"},on:{click:e.handle_bind}}),e._v(" "),a("el-button",{attrs:{icon:"el-icon-arrow-left"},on:{click:e.handle_unbind}})],1)]),e._v(" "),a("el-col",[a("CardBox",{attrs:{title:"确认绑定"}},[a("template",{slot:"body"},[a("div",{staticClass:"search_box"},[a("el-input",{staticStyle:{width:"219px"},attrs:{placeholder:"请输入模板名称","suffix-icon":"el-icon-search",size:"small"},model:{value:e.search_input.right_search,callback:function(t){e.$set(e.search_input,"right_search",t)},expression:"search_input.right_search"}}),e._v(" "),a("div",[a("el-button",{staticStyle:{background:"none"},attrs:{type:"primary",plain:"",size:"small"},on:{click:e.right_reset_search}},[e._v("重置")]),e._v(" "),a("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.right_search}},[e._v("查询")])],1)],1),e._v(" "),a("div",{staticClass:"search_table"},[e.right_search_flag?a("div",[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.search_bind_template_table_data.slice((e.right_current_page-1)*e.right_page_size,e.right_current_page*e.right_page_size),border:"",size:"small"},on:{"selection-change":e.right_selected}},[a("el-table-column",{attrs:{type:"selection",width:"30"}}),e._v(" "),a("el-table-column",{attrs:{prop:"case_template_id",label:"测试模板ID",width:"100"}}),e._v(" "),a("el-table-column",{attrs:{prop:"module_name",label:"测试模板名称","show-overflow-tooltip":!0}})],1),e._v(" "),a("div",{staticClass:"search_pagination"},[a("el-pagination",{attrs:{"current-page":e.right_current_page,"page-sizes":[5,10,15],"page-size":e.right_page_size,layout:"sizes, prev, pager, next",total:e.search_bind_template_table_data.length},on:{"size-change":e.right_handle_size_change,"current-change":e.right_handle_current_change,"update:currentPage":function(t){e.right_current_page=t},"update:current-page":function(t){e.right_current_page=t}}})],1)],1):a("div",[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.bind_template_table_data.slice((e.right_current_page-1)*e.right_page_size,e.right_current_page*e.right_page_size),border:"",size:"small"},on:{"selection-change":e.right_selected}},[a("el-table-column",{attrs:{type:"selection",width:"30"}}),e._v(" "),a("el-table-column",{attrs:{prop:"case_template_id",label:"测试模板ID",width:"100"}}),e._v(" "),a("el-table-column",{attrs:{prop:"module_name",label:"测试模板名称","show-overflow-tooltip":!0}})],1),e._v(" "),a("div",{staticClass:"search_pagination"},[a("el-pagination",{attrs:{"current-page":e.right_current_page,"page-sizes":[5,10,15],"page-size":e.right_page_size,layout:"sizes, prev, pager, next",total:e.bind_template_table_data.length},on:{"size-change":e.right_handle_size_change,"current-change":e.right_handle_current_change,"update:currentPage":function(t){e.right_current_page=t},"update:current-page":function(t){e.right_current_page=t}}})],1)],1)])])],2)],1)],1)],1)]],2)},staticRenderFns:[]};var l=a("VU/8")(_,r,!1,function(e){a("cw3L"),a("X/WS")},"data-v-2d310be9",null);t.default=l.exports},"X/WS":function(e,t){},cw3L:function(e,t){}});
//# sourceMappingURL=9.991b93538e534a1c2448.js.map